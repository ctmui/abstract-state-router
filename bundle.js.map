{"version":3,"file":"bundle.js","sources":["lib/state-string-parser.js","lib/state-state.js","lib/extend.js","lib/state-comparison.js","lib/current-state.js","lib/state-change-logic.js","lib/state-transition-manager.js","default-router-options.js","lib/promise-map-series.js","index.js"],"sourcesContent":["module.exports = stateString => {\n\treturn stateString.split('.').reduce((stateNames, latestNameChunk) => {\n\t\tstateNames.push(\n\t\t\tstateNames.length\n\t\t\t\t? stateNames[stateNames.length - 1] + '.' + latestNameChunk\n\t\t\t\t: latestNameChunk\n\t\t)\n\n\t\treturn stateNames\n\t}, [])\n}\n","const stateStringParser = require('./state-string-parser')\n\nmodule.exports = function StateState() {\n\tconst states = {}\n\n\tfunction getHierarchy(name) {\n\t\tconst names = stateStringParser(name)\n\n\t\treturn names.map(name => {\n\t\t\tif (!states[name]) {\n\t\t\t\tthrow new Error(`State ${name} not found`)\n\t\t\t}\n\t\t\treturn states[name]\n\t\t})\n\t}\n\n\tfunction getParent(name) {\n\t\tconst parentName = getParentName(name)\n\n\t\treturn parentName && states[parentName]\n\t}\n\n\tfunction getParentName(name) {\n\t\tconst names = stateStringParser(name)\n\n\t\tif (names.length > 1) {\n\t\t\tconst secondToLast = names.length - 2\n\n\t\t\treturn names[secondToLast]\n\t\t} else {\n\t\t\treturn null\n\t\t}\n\t}\n\n\tfunction guaranteeAllStatesExist(newStateName) {\n\t\tconst stateNames = stateStringParser(newStateName)\n\t\tconst statesThatDontExist = stateNames.filter(name => !states[name])\n\n\t\tif (statesThatDontExist.length > 0) {\n\t\t\tthrow new Error(`State ${statesThatDontExist[statesThatDontExist.length - 1]} does not exist`)\n\t\t}\n\t}\n\n\tfunction buildFullStateRoute(stateName) {\n\t\treturn getHierarchy(stateName).map(state => `/${state.route || ''}`)\n\t\t\t.join('')\n\t\t\t.replace(/\\/{2,}/g, '/')\n\t}\n\n\tfunction applyDefaultChildStates(stateName) {\n\t\tconst state = states[stateName]\n\n\t\tconst defaultChildStateName = state && (\n\t\t\ttypeof state.defaultChild === 'function'\n\t\t\t\t? state.defaultChild()\n\t\t\t\t: state.defaultChild\n\t\t)\n\n\t\tif (!defaultChildStateName) {\n\t\t\treturn stateName\n\t\t}\n\n\t\tconst fullStateName = `${stateName}.${defaultChildStateName}`\n\n\t\treturn applyDefaultChildStates(fullStateName)\n\t}\n\n\n\treturn {\n\t\tadd(name, state) {\n\t\t\tstates[name] = state\n\t\t},\n\t\tget(name) {\n\t\t\treturn name && states[name]\n\t\t},\n\t\tgetHierarchy,\n\t\tgetParent,\n\t\tgetParentName,\n\t\tguaranteeAllStatesExist,\n\t\tbuildFullStateRoute,\n\t\tapplyDefaultChildStates,\n\t}\n}\n","module.exports = (...args) => Object.assign({}, ...args)\n","const stateStringParser = require('./state-string-parser')\nconst extend = require('./extend.js')\n\nconst combine = require('combine-arrays')\nconst pathToRegexp = require('path-to-regexp-with-reversible-keys')\n\nmodule.exports = function StateComparison(stateState) {\n\tconst getPathParameters = pathParameters()\n\n\tconst parametersChanged = args => parametersThatMatterWereChanged(extend(args, { stateState, getPathParameters }))\n\n\treturn args => stateComparison(extend(args, { parametersChanged }))\n}\n\nfunction pathParameters() {\n\tconst parameters = {}\n\n\treturn path => {\n\t\tif (!path) {\n\t\t\treturn []\n\t\t}\n\n\t\tif (!parameters[path]) {\n\t\t\tparameters[path] = pathToRegexp(path).keys.map(function(key) {\n\t\t\t\treturn key.name\n\t\t\t})\n\t\t}\n\n\t\treturn parameters[path]\n\t}\n}\n\nfunction parametersThatMatterWereChanged({ stateState, getPathParameters, stateName, fromParameters, toParameters }) {\n\tconst state = stateState.get(stateName)\n\tconst querystringParameters = state.querystringParameters || []\n\tconst parameters = getPathParameters(state.route).concat(querystringParameters)\n\n\treturn Array.isArray(parameters) && parameters.some(\n\t\tkey => fromParameters[key] !== toParameters[key]\n\t)\n}\n\nfunction stateComparison({ parametersChanged, original, destination }) {\n\tconst states = combine({\n\t\tstart: stateStringParser(original.name),\n\t\tend: stateStringParser(destination.name),\n\t})\n\n\treturn states.map(({ start, end }) => ({\n\t\tnameBefore: start,\n\t\tnameAfter: end,\n\t\tstateNameChanged: start !== end,\n\t\tstateParametersChanged: start === end && parametersChanged({\n\t\t\tstateName: start,\n\t\t\tfromParameters: original.parameters,\n\t\t\ttoParameters: destination.parameters,\n\t\t}),\n\t}))\n}\n","module.exports = function CurrentState() {\n\tlet current = {\n\t\tname: '',\n\t\tparameters: {},\n\t}\n\n\treturn {\n\t\tget() {\n\t\t\treturn current\n\t\t},\n\t\tset(name, parameters) {\n\t\t\tcurrent = {\n\t\t\t\tname,\n\t\t\t\tparameters,\n\t\t\t}\n\t\t},\n\t}\n}\n","module.exports = function stateChangeLogic(stateComparisonResults) {\n\tlet hitChangingState = false\n\tlet hitDestroyedState = false\n\n\tconst output = {\n\t\tdestroy: [],\n\t\tchange: [],\n\t\tcreate: [],\n\t}\n\n\tstateComparisonResults.forEach(state => {\n\t\thitChangingState = hitChangingState || state.stateParametersChanged\n\t\thitDestroyedState = hitDestroyedState || state.stateNameChanged\n\n\t\tif (state.nameBefore) {\n\t\t\tif (hitDestroyedState) {\n\t\t\t\toutput.destroy.push(state.nameBefore)\n\t\t\t} else if (hitChangingState) {\n\t\t\t\toutput.change.push(state.nameBefore)\n\t\t\t}\n\t\t}\n\n\t\tif (state.nameAfter && hitDestroyedState) {\n\t\t\toutput.create.push(state.nameAfter)\n\t\t}\n\t})\n\n\treturn output\n}\n","module.exports = emitter => {\r\n\tlet currentTransitionAttempt = null\r\n\tlet nextTransition = null\r\n\r\n\tfunction doneTransitioning() {\r\n\t\tcurrentTransitionAttempt = null\r\n\t\tif (nextTransition) {\r\n\t\t\tbeginNextTransitionAttempt()\r\n\t\t}\r\n\t}\r\n\r\n\tconst isTransitioning = () => !!currentTransitionAttempt\r\n\r\n\tfunction beginNextTransitionAttempt() {\r\n\t\tcurrentTransitionAttempt = nextTransition\r\n\t\tnextTransition = null\r\n\t\tcurrentTransitionAttempt.beginStateChange()\r\n\t}\r\n\r\n\tfunction cancelCurrentTransition() {\r\n\t\tcurrentTransitionAttempt.transition.cancelled = true\r\n\t\tconst err = new Error('State transition cancelled by the state transition manager')\r\n\t\terr.wasCancelledBySomeoneElse = true\r\n\t\temitter.emit('stateChangeCancelled', err)\r\n\t}\r\n\r\n\temitter.on('stateChangeAttempt', beginStateChange => {\r\n\t\tnextTransition = createStateTransitionAttempt(beginStateChange)\r\n\r\n\t\tif (isTransitioning() && currentTransitionAttempt.transition.cancellable) {\r\n\t\t\tcancelCurrentTransition()\r\n\t\t} else if (!isTransitioning()) {\r\n\t\t\tbeginNextTransitionAttempt()\r\n\t\t}\r\n\t})\r\n\r\n\temitter.on('stateChangeError', doneTransitioning)\r\n\temitter.on('stateChangeCancelled', doneTransitioning)\r\n\temitter.on('stateChangeEnd', doneTransitioning)\r\n\r\n\tfunction createStateTransitionAttempt(beginStateChange) {\r\n\t\tconst transition = {\r\n\t\t\tcancelled: false,\r\n\t\t\tcancellable: true,\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttransition,\r\n\t\t\tbeginStateChange: (...args) => beginStateChange(transition, ...args),\r\n\t\t}\r\n\t}\r\n}\r\n","module.exports = { reverse: false }","// Pulled from https://github.com/joliss/promise-map-series and prettied up a bit\n\nmodule.exports = function sequence(array, iterator) {\n\tlet currentPromise = Promise.resolve()\n\treturn Promise.all(\n\t\tarray.map((value, i) => {\n\t\t\treturn currentPromise = currentPromise.then(() => iterator(value, i, array))\n\t\t})\n\t)\n}\n","const StateState = require('./lib/state-state')\nconst StateComparison = require('./lib/state-comparison')\nconst CurrentState = require('./lib/current-state')\nconst stateChangeLogic = require('./lib/state-change-logic')\nconst parse = require('./lib/state-string-parser')\nconst StateTransitionManager = require('./lib/state-transition-manager')\nconst defaultRouterOptions = require('./default-router-options.js')\n\nconst series = require('./lib/promise-map-series')\nconst extend = require('./lib/extend.js')\n\nconst denodeify = require('then-denodeify')\nconst EventEmitter = require('eventemitter3')\nconst newHashBrownRouter = require('hash-brown-router')\nconst combine = require('combine-arrays')\nconst buildPath = require('page-path-builder')\nconst nextTick = require('iso-next-tick')\n\nconst getProperty = name => obj => obj[name]\nconst reverse = ary => ary.slice().reverse()\nconst isFunction = property => obj => typeof obj[property] === 'function'\nconst isThenable = object => object && (typeof object === 'object' || typeof object === 'function') && typeof object.then === 'function'\nconst promiseMe = (fn, ...args) => new Promise(resolve => resolve(fn(...args)))\n\nconst expectedPropertiesOfAddState = [ 'name', 'route', 'defaultChild', 'data', 'template', 'resolve', 'activate', 'querystringParameters', 'defaultQuerystringParameters', 'defaultParameters' ]\n\nmodule.exports = function StateProvider(makeRenderer, rootElement, stateRouterOptions = {}) {\n\tconst prototypalStateHolder = StateState()\n\tconst lastCompletelyLoadedState = CurrentState()\n\tconst lastStateStartedActivating = CurrentState()\n\tconst stateProviderEmitter = new EventEmitter()\n\tconst compareStartAndEndStates = StateComparison(prototypalStateHolder)\n\n\tconst stateNameToArrayofStates = stateName => parse(stateName).map(prototypalStateHolder.get)\n\n\tStateTransitionManager(stateProviderEmitter)\n\tconst { throwOnError, pathPrefix } = extend({\n\t\tthrowOnError: true,\n\t\tpathPrefix: '#',\n\t}, stateRouterOptions)\n\n\tconst router = stateRouterOptions.router || newHashBrownRouter(defaultRouterOptions)\n\n\trouter.on('not found', (route, parameters) => {\n\t\tstateProviderEmitter.emit('routeNotFound', route, parameters)\n\t})\n\n\tlet destroyDom = null\n\tlet getDomChild = null\n\tlet renderDom = null\n\tlet resetDom = null\n\n\tlet activeStateResolveContent = {}\n\tconst activeDomApis = {}\n\tconst activeEmitters = {}\n\n\tfunction handleError(event, err) {\n\t\tnextTick(() => {\n\t\t\tstateProviderEmitter.emit(event, err)\n\t\t\tconsole.error(`${event} - ${err.message}`)\n\t\t\tif (throwOnError) {\n\t\t\t\tthrow err\n\t\t\t}\n\t\t})\n\t}\n\n\tfunction destroyStateName(stateName) {\n\t\tconst state = prototypalStateHolder.get(stateName)\n\t\tstateProviderEmitter.emit('beforeDestroyState', {\n\t\t\tstate: state,\n\t\t\tdomApi: activeDomApis[stateName],\n\t\t})\n\n\t\tactiveEmitters[stateName].emit('destroy')\n\t\tactiveEmitters[stateName].removeAllListeners()\n\t\tdelete activeEmitters[stateName]\n\t\tdelete activeStateResolveContent[stateName]\n\n\t\treturn destroyDom(activeDomApis[stateName]).then(() => {\n\t\t\tdelete activeDomApis[stateName]\n\t\t\tstateProviderEmitter.emit('afterDestroyState', {\n\t\t\t\tstate,\n\t\t\t})\n\t\t})\n\t}\n\n\tfunction resetStateName(parameters, stateName) {\n\t\tconst domApi = activeDomApis[stateName]\n\t\tconst content = getContentObject(activeStateResolveContent, stateName)\n\t\tconst state = prototypalStateHolder.get(stateName)\n\n\t\tstateProviderEmitter.emit('beforeResetState', {\n\t\t\tdomApi,\n\t\t\tcontent,\n\t\t\tstate,\n\t\t\tparameters,\n\t\t})\n\n\t\tactiveEmitters[stateName].emit('destroy')\n\t\tdelete activeEmitters[stateName]\n\n\t\treturn resetDom({\n\t\t\tdomApi,\n\t\t\tcontent,\n\t\t\ttemplate: state.template,\n\t\t\tparameters,\n\t\t}).then(newDomApi => {\n\t\t\tif (newDomApi) {\n\t\t\t\tactiveDomApis[stateName] = newDomApi\n\t\t\t}\n\n\t\t\tstateProviderEmitter.emit('afterResetState', {\n\t\t\t\tdomApi: activeDomApis[stateName],\n\t\t\t\tcontent,\n\t\t\t\tstate,\n\t\t\t\tparameters,\n\t\t\t})\n\t\t})\n\t}\n\n\tfunction getChildElementForStateName(stateName) {\n\t\treturn new Promise(resolve => {\n\t\t\tconst parent = prototypalStateHolder.getParent(stateName)\n\t\t\tif (parent) {\n\t\t\t\tconst parentDomApi = activeDomApis[parent.name]\n\t\t\t\tresolve(getDomChild(parentDomApi))\n\t\t\t} else {\n\t\t\t\tresolve(rootElement)\n\t\t\t}\n\t\t})\n\t}\n\n\tfunction renderStateName(parameters, stateName) {\n\t\treturn getChildElementForStateName(stateName).then(element => {\n\t\t\tconst state = prototypalStateHolder.get(stateName)\n\t\t\tconst content = getContentObject(activeStateResolveContent, stateName)\n\n\t\t\tstateProviderEmitter.emit('beforeCreateState', {\n\t\t\t\tstate,\n\t\t\t\tcontent,\n\t\t\t\tparameters,\n\t\t\t})\n\n\t\t\treturn renderDom({\n\t\t\t\ttemplate: state.template,\n\t\t\t\telement,\n\t\t\t\tcontent,\n\t\t\t\tparameters,\n\t\t\t}).then(domApi => {\n\t\t\t\tactiveDomApis[stateName] = domApi\n\t\t\t\tstateProviderEmitter.emit('afterCreateState', {\n\t\t\t\t\tstate,\n\t\t\t\t\tdomApi,\n\t\t\t\t\tcontent,\n\t\t\t\t\tparameters,\n\t\t\t\t})\n\t\t\t\treturn domApi\n\t\t\t})\n\t\t})\n\t}\n\n\tfunction renderAll(stateNames, parameters) {\n\t\treturn series(stateNames, stateName => renderStateName(parameters, stateName))\n\t}\n\n\tfunction onRouteChange(state, parameters) {\n\t\ttry {\n\t\t\tconst finalDestinationStateName = prototypalStateHolder.applyDefaultChildStates(state.name)\n\n\t\t\tif (finalDestinationStateName === state.name) {\n\t\t\t\temitEventAndAttemptStateChange(finalDestinationStateName, parameters)\n\t\t\t} else {\n\t\t\t\t// There are default child states that need to be applied\n\n\t\t\t\tconst theRouteWeNeedToEndUpAt = makePath(finalDestinationStateName, parameters)\n\t\t\t\tconst currentRoute = router.location.get()\n\n\t\t\t\tif (theRouteWeNeedToEndUpAt === currentRoute) {\n\t\t\t\t\t// the child state has the same route as the current one, just start navigating there\n\t\t\t\t\temitEventAndAttemptStateChange(finalDestinationStateName, parameters)\n\t\t\t\t} else {\n\t\t\t\t\t// change the url to match the full default child state route\n\t\t\t\t\tstateProviderEmitter.go(finalDestinationStateName, parameters, { replace: true })\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err) {\n\t\t\thandleError('stateError', err)\n\t\t}\n\t}\n\n\tfunction addState(state) {\n\t\tif (typeof state === 'undefined') {\n\t\t\tthrow new Error(`Expected 'state' to be passed in.`)\n\t\t} else if (typeof state.name === 'undefined') {\n\t\t\tthrow new Error(`Expected the 'name' option to be passed in.`)\n\t\t} else if (typeof state.template === 'undefined') {\n\t\t\tthrow new Error(`Expected the 'template' option to be passed in.`)\n\t\t}\n\t\tObject.keys(state).filter(key => {\n\t\t\treturn expectedPropertiesOfAddState.indexOf(key) === -1\n\t\t}).forEach(key => {\n\t\t\tconsole.warn('Unexpected property passed to addState:', key)\n\t\t})\n\n\t\tprototypalStateHolder.add(state.name, state)\n\n\t\tconst route = prototypalStateHolder.buildFullStateRoute(state.name)\n\n\t\trouter.add(route, parameters => onRouteChange(state, parameters))\n\t}\n\n\tfunction getStatesToResolve(stateChanges) {\n\t\treturn stateChanges.change.concat(stateChanges.create).map(prototypalStateHolder.get)\n\t}\n\n\tfunction emitEventAndAttemptStateChange(newStateName, parameters) {\n\t\tstateProviderEmitter.emit('stateChangeAttempt', function stateGo(transition) {\n\t\t\tattemptStateChange(newStateName, parameters, transition)\n\t\t})\n\t}\n\n\tfunction attemptStateChange(newStateName, parameters, transition) {\n\t\tfunction ifNotCancelled(fn) {\n\t\t\treturn (...args) => {\n\t\t\t\tif (transition.cancelled) {\n\t\t\t\t\tconst err = new Error(`The transition to ${newStateName} was cancelled`)\n\t\t\t\t\terr.wasCancelledBySomeoneElse = true\n\t\t\t\t\tthrow err\n\t\t\t\t} else {\n\t\t\t\t\treturn fn(...args)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn promiseMe(prototypalStateHolder.guaranteeAllStatesExist, newStateName)\n\t\t\t.then(function applyDefaultParameters() {\n\t\t\t\tconst state = prototypalStateHolder.get(newStateName)\n\t\t\t\tconst defaultParams = state.defaultParameters || state.defaultQuerystringParameters || {}\n\t\t\t\tconst needToApplyDefaults = Object.keys(defaultParams).some(function missingParameterValue(param) {\n\t\t\t\t\treturn typeof parameters[param] === 'undefined'\n\t\t\t\t})\n\n\t\t\t\tif (needToApplyDefaults) {\n\t\t\t\t\tthrow redirector(newStateName, extend(defaultParams, parameters))\n\t\t\t\t}\n\t\t\t\treturn state\n\t\t\t}).then(ifNotCancelled(state => {\n\t\t\t\tstateProviderEmitter.emit('stateChangeStart', state, parameters, stateNameToArrayofStates(state.name))\n\t\t\t\tlastStateStartedActivating.set(state.name, parameters)\n\t\t\t})).then(function getStateChanges() {\n\t\t\t\tconst stateComparisonResults = compareStartAndEndStates({\n\t\t\t\t\toriginal: lastCompletelyLoadedState.get(),\n\t\t\t\t\tdestination: {\n\t\t\t\t\t\tname: newStateName,\n\t\t\t\t\t\tparameters,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\treturn stateChangeLogic(stateComparisonResults) // { destroy, change, create }\n\t\t\t}).then(ifNotCancelled(function resolveDestroyAndActivateStates(stateChanges) {\n\t\t\t\treturn resolveStates(getStatesToResolve(stateChanges), extend(parameters)).catch(function onResolveError(e) {\n\t\t\t\t\te.stateChangeError = true\n\t\t\t\t\tthrow e\n\t\t\t\t}).then(ifNotCancelled(function destroyAndActivate(stateResolveResultsObject) {\n\t\t\t\t\ttransition.cancellable = false\n\n\t\t\t\t\tconst activateAll = () => activateStates(\n\t\t\t\t\t\tstateChanges.change.concat(stateChanges.create)\n\t\t\t\t\t)\n\n\t\t\t\t\tactiveStateResolveContent = extend(activeStateResolveContent, stateResolveResultsObject)\n\n\t\t\t\t\treturn series(reverse(stateChanges.destroy), destroyStateName).then(() => {\n\t\t\t\t\t\treturn series(\n\t\t\t\t\t\t\treverse(stateChanges.change),\n\t\t\t\t\t\t\tstateName => resetStateName(extend(parameters), stateName)\n\t\t\t\t\t\t)\n\t\t\t\t\t}).then(\n\t\t\t\t\t\t() => renderAll(stateChanges.create, extend(parameters)).then(activateAll)\n\t\t\t\t\t)\n\t\t\t\t}))\n\n\t\t\t\tfunction activateStates(stateNames) {\n\t\t\t\t\treturn stateNames.map(prototypalStateHolder.get).forEach(state => {\n\t\t\t\t\t\tconst emitter = new EventEmitter()\n\t\t\t\t\t\tconst context = Object.create(emitter)\n\t\t\t\t\t\tcontext.domApi = activeDomApis[state.name]\n\t\t\t\t\t\tcontext.data = state.data\n\t\t\t\t\t\tcontext.parameters = parameters\n\t\t\t\t\t\tcontext.content = getContentObject(activeStateResolveContent, state.name)\n\t\t\t\t\t\tactiveEmitters[state.name] = emitter\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tstate.activate && state.activate(context)\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tnextTick(() => {\n\t\t\t\t\t\t\t\tthrow e\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})).then(function stateChangeComplete() {\n\t\t\t\tlastCompletelyLoadedState.set(newStateName, parameters)\n\t\t\t\ttry {\n\t\t\t\t\tstateProviderEmitter.emit('stateChangeEnd', prototypalStateHolder.get(newStateName), parameters, stateNameToArrayofStates(newStateName))\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleError('stateError', e)\n\t\t\t\t}\n\t\t\t}).catch(ifNotCancelled(function handleStateChangeError(err) {\n\t\t\t\tif (err && err.redirectTo) {\n\t\t\t\t\tstateProviderEmitter.emit('stateChangeCancelled', err)\n\t\t\t\t\treturn stateProviderEmitter.go(err.redirectTo.name, err.redirectTo.params, { replace: true })\n\t\t\t\t} else if (err) {\n\t\t\t\t\thandleError('stateChangeError', err)\n\t\t\t\t}\n\t\t\t})).catch(function handleCancellation(err) {\n\t\t\t\tif (err && err.wasCancelledBySomeoneElse) {\n\t\t\t\t\t// we don't care, the state transition manager has already emitted the stateChangeCancelled for us\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(`This probably shouldn't happen, maybe file an issue or something ${err}`)\n\t\t\t\t}\n\t\t\t})\n\t}\n\n\tfunction makePath(stateName, parameters, options) {\n\t\tfunction getGuaranteedPreviousState() {\n\t\t\tif (!lastStateStartedActivating.get().name) {\n\t\t\t\tthrow new Error('makePath required a previous state to exist, and none was found')\n\t\t\t}\n\t\t\treturn lastStateStartedActivating.get()\n\t\t}\n\t\tif (options && options.inherit) {\n\t\t\tparameters = extend(getGuaranteedPreviousState().parameters, parameters)\n\t\t}\n\n\t\tconst destinationStateName = stateName === null ? getGuaranteedPreviousState().name : stateName\n\n\t\tconst destinationState = prototypalStateHolder.get(destinationStateName) || {}\n\t\tconst defaultParams = destinationState.defaultParameters || destinationState.defaultQuerystringParameters\n\n\t\tparameters = extend(defaultParams, parameters)\n\n\t\tprototypalStateHolder.guaranteeAllStatesExist(destinationStateName)\n\t\tconst route = prototypalStateHolder.buildFullStateRoute(destinationStateName)\n\t\treturn buildPath(route, parameters || {})\n\t}\n\n\tconst defaultOptions = {\n\t\treplace: false,\n\t}\n\n\tstateProviderEmitter.addState = addState\n\tstateProviderEmitter.go = (newStateName, parameters, options) => {\n\t\toptions = extend(defaultOptions, options)\n\t\tconst goFunction = options.replace ? router.replace : router.go\n\n\t\treturn promiseMe(makePath, newStateName, parameters, options)\n\t\t\t.then(goFunction, err => handleError('stateChangeError', err))\n\t}\n\tstateProviderEmitter.evaluateCurrentRoute = (defaultState, defaultParams) => {\n\t\treturn promiseMe(makePath, defaultState, defaultParams).then(defaultPath => {\n\t\t\trouter.evaluateCurrent(defaultPath)\n\t\t}).catch(err => handleError('stateError', err))\n\t}\n\tstateProviderEmitter.makePath = (stateName, parameters, options) => {\n\t\treturn pathPrefix + makePath(stateName, parameters, options)\n\t}\n\tstateProviderEmitter.getActiveState = () => {\n    console.log(lastCompletelyLoadedState.get());\n    return lastCompletelyLoadedState.get()\n\t}\n\tstateProviderEmitter.stateIsActive = (stateName, parameters = null) => {\n\t\tconst currentState = lastCompletelyLoadedState.get()\n\t\tconst stateNameMatches = currentState.name === stateName || currentState.name.indexOf(stateName + '.') === 0\n\t\tconst parametersWereNotPassedIn = !parameters\n\n\t\treturn stateNameMatches\n\t\t\t&& (parametersWereNotPassedIn || Object.keys(parameters).every(key => parameters[key] === currentState.parameters[key]))\n\t}\n\n\tconst renderer = makeRenderer(stateProviderEmitter)\n\n\tdestroyDom = denodeify(renderer.destroy)\n\tgetDomChild = denodeify(renderer.getChildElement)\n\trenderDom = denodeify(renderer.render)\n\tresetDom = denodeify(renderer.reset)\n\n\treturn stateProviderEmitter\n}\n\nfunction getContentObject(stateResolveResultsObject, stateName) {\n\tconst allPossibleResolvedStateNames = parse(stateName)\n\n\treturn allPossibleResolvedStateNames\n\t\t.filter(stateName => stateResolveResultsObject[stateName])\n\t\t.reduce((obj, stateName) => {\n\t\t\treturn extend(obj, stateResolveResultsObject[stateName])\n\t\t}, {})\n}\n\nfunction redirector(newStateName, parameters) {\n\treturn {\n\t\tredirectTo: {\n\t\t\tname: newStateName,\n\t\t\tparams: parameters,\n\t\t},\n\t}\n}\n\n// { [stateName]: resolveResult }\nfunction resolveStates(states, parameters) {\n\tconst statesWithResolveFunctions = states.filter(isFunction('resolve'))\n\tconst stateNamesWithResolveFunctions = statesWithResolveFunctions.map(getProperty('name'))\n\n\tconst resolves = Promise.all(statesWithResolveFunctions.map(state => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst resolveCb = (err, content) => err ? reject(err) : resolve(content)\n\n\t\t\tresolveCb.redirect = (newStateName, parameters) => {\n\t\t\t\treject(redirector(newStateName, parameters))\n\t\t\t}\n\n\t\t\tconst res = state.resolve(state.data, parameters, resolveCb)\n\t\t\tif (isThenable(res)) {\n\t\t\t\tresolve(res)\n\t\t\t}\n\t\t})\n\t}))\n\n\treturn resolves.then(resolveResults =>\n\t\tcombine({\n\t\t\tstateName: stateNamesWithResolveFunctions,\n\t\t\tresolveResult: resolveResults,\n\t\t}).reduce((obj, result) => {\n\t\t\tobj[result.stateName] = result.resolveResult\n\t\t\treturn obj\n\t\t}, {})\n\t)\n}\n"],"names":["stateString","split","reduce","stateNames","latestNameChunk","push","length","StateState","states","getHierarchy","name","names","stateStringParser","map","Error","getParent","parentName","getParentName","secondToLast","guaranteeAllStatesExist","newStateName","statesThatDontExist","filter","buildFullStateRoute","stateName","state","route","join","replace","applyDefaultChildStates","defaultChildStateName","defaultChild","fullStateName","args","Object","assign","StateComparison","stateState","getPathParameters","pathParameters","parametersChanged","parametersThatMatterWereChanged","extend","stateComparison","parameters","path","pathToRegexp","keys","key","fromParameters","toParameters","get","querystringParameters","concat","Array","isArray","some","original","destination","combine","start","end","CurrentState","current","stateChangeLogic","stateComparisonResults","hitChangingState","hitDestroyedState","output","forEach","stateParametersChanged","stateNameChanged","nameBefore","destroy","change","nameAfter","create","currentTransitionAttempt","nextTransition","doneTransitioning","isTransitioning","beginNextTransitionAttempt","beginStateChange","cancelCurrentTransition","transition","cancelled","err","wasCancelledBySomeoneElse","emit","on","createStateTransitionAttempt","cancellable","reverse","sequence","array","iterator","currentPromise","Promise","resolve","all","value","i","then","getProperty","obj","ary","slice","isFunction","property","isThenable","object","promiseMe","fn","expectedPropertiesOfAddState","StateProvider","makeRenderer","rootElement","stateRouterOptions","prototypalStateHolder","lastCompletelyLoadedState","lastStateStartedActivating","stateProviderEmitter","EventEmitter","compareStartAndEndStates","stateNameToArrayofStates","parse","throwOnError","pathPrefix","router","newHashBrownRouter","defaultRouterOptions","destroyDom","getDomChild","renderDom","resetDom","activeStateResolveContent","activeDomApis","activeEmitters","handleError","event","error","message","destroyStateName","removeAllListeners","resetStateName","domApi","content","getContentObject","template","newDomApi","getChildElementForStateName","parent","parentDomApi","renderStateName","renderAll","series","onRouteChange","finalDestinationStateName","theRouteWeNeedToEndUpAt","makePath","currentRoute","location","go","addState","indexOf","warn","add","getStatesToResolve","stateChanges","emitEventAndAttemptStateChange","stateGo","attemptStateChange","ifNotCancelled","applyDefaultParameters","defaultParams","defaultParameters","defaultQuerystringParameters","needToApplyDefaults","missingParameterValue","param","redirector","set","getStateChanges","resolveDestroyAndActivateStates","resolveStates","catch","onResolveError","e","stateChangeError","destroyAndActivate","stateResolveResultsObject","activateAll","activateStates","emitter","context","data","activate","stateChangeComplete","handleStateChangeError","redirectTo","params","handleCancellation","options","getGuaranteedPreviousState","inherit","destinationStateName","destinationState","buildPath","defaultOptions","goFunction","evaluateCurrentRoute","defaultState","evaluateCurrent","defaultPath","getActiveState","log","stateIsActive","currentState","stateNameMatches","parametersWereNotPassedIn","every","renderer","denodeify","getChildElement","render","reset","allPossibleResolvedStateNames","statesWithResolveFunctions","stateNamesWithResolveFunctions","resolves","reject","resolveCb","redirect","res","resolveResults","result","resolveResult"],"mappings":"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"}